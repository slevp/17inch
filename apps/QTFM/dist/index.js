define("ekai/qtfm/1.0.0/index",["./main","backbone","./routers/index","jquery","./views/broadcast/index","underscore","./views/nav","./templates/nav.tpl","./views/broadcast/main","store","topivi","iscroll","./templates/broadcast/main.tpl","./templates/loading.tpl","./collections/radio-category","./models/radio-category","./settings.json","./views/broadcast/sub-category","./templates/broadcast/sub-category.tpl","./views/lately/index","./views/lately/main","./templates/lately/main.tpl","./collections/lately-channel","./collections/channel","./models/channel","./views/footer-play","./templates/footer-play.tpl","./views/channel-list","./views/channel-item","./templates/channel-item.tpl","./views/favorites/index","./views/favorites/main","./templates/favorites/main.tpl","./collections/favorites-channel","./views/channel/index","./views/channel/main","./templates/channel/main.tpl","./views/program/index","./views/program/main","./templates/program/main.tpl","./collections/program","./models/program","./views/program/program-list","./views/program/program-item","./templates/program/program-item.tpl","./util","./views/play/index","./templates/play/main.tpl","./player"],function(a,b,c){c.exports=a("./main")}),define("ekai/qtfm/1.0.0/main",["backbone","ekai/qtfm/1.0.0/routers/index","jquery","ekai/qtfm/1.0.0/views/broadcast/index","underscore","ekai/qtfm/1.0.0/views/nav","ekai/qtfm/1.0.0/views/broadcast/main","store","topivi","iscroll","ekai/qtfm/1.0.0/collections/radio-category","ekai/qtfm/1.0.0/models/radio-category","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/broadcast/sub-category","ekai/qtfm/1.0.0/views/lately/index","ekai/qtfm/1.0.0/views/lately/main","ekai/qtfm/1.0.0/collections/lately-channel","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","ekai/qtfm/1.0.0/views/channel-item","ekai/qtfm/1.0.0/views/favorites/index","ekai/qtfm/1.0.0/views/favorites/main","ekai/qtfm/1.0.0/collections/favorites-channel","ekai/qtfm/1.0.0/views/channel/index","ekai/qtfm/1.0.0/views/channel/main","ekai/qtfm/1.0.0/views/program/index","ekai/qtfm/1.0.0/views/program/main","ekai/qtfm/1.0.0/collections/program","ekai/qtfm/1.0.0/models/program","ekai/qtfm/1.0.0/views/program/program-list","ekai/qtfm/1.0.0/views/program/program-item","ekai/qtfm/1.0.0/util","ekai/qtfm/1.0.0/views/play/index","ekai/qtfm/1.0.0/player"],function(a){var b=a("backbone"),c=a("ekai/qtfm/1.0.0/routers/index");new c,b.history.start()}),define("ekai/qtfm/1.0.0/routers/index",["jquery","backbone","ekai/qtfm/1.0.0/views/broadcast/index","underscore","ekai/qtfm/1.0.0/views/nav","ekai/qtfm/1.0.0/views/broadcast/main","store","topivi","iscroll","ekai/qtfm/1.0.0/collections/radio-category","ekai/qtfm/1.0.0/models/radio-category","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/broadcast/sub-category","ekai/qtfm/1.0.0/views/lately/index","ekai/qtfm/1.0.0/views/lately/main","ekai/qtfm/1.0.0/collections/lately-channel","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","ekai/qtfm/1.0.0/views/channel-item","ekai/qtfm/1.0.0/views/favorites/index","ekai/qtfm/1.0.0/views/favorites/main","ekai/qtfm/1.0.0/collections/favorites-channel","ekai/qtfm/1.0.0/views/channel/index","ekai/qtfm/1.0.0/views/channel/main","ekai/qtfm/1.0.0/views/program/index","ekai/qtfm/1.0.0/views/program/main","ekai/qtfm/1.0.0/collections/program","ekai/qtfm/1.0.0/models/program","ekai/qtfm/1.0.0/views/program/program-list","ekai/qtfm/1.0.0/views/program/program-item","ekai/qtfm/1.0.0/util","ekai/qtfm/1.0.0/views/play/index","ekai/qtfm/1.0.0/player"],function(a,b,c){var d,e,f,g,h,i,j=a("jquery"),k=a("backbone"),l=a("ekai/qtfm/1.0.0/views/broadcast/index"),m=a("ekai/qtfm/1.0.0/views/lately/index"),n=a("ekai/qtfm/1.0.0/views/favorites/index"),o=a("ekai/qtfm/1.0.0/views/channel/index"),p=a("ekai/qtfm/1.0.0/views/program/index"),q=a("ekai/qtfm/1.0.0/views/play/index"),r=a("ekai/qtfm/1.0.0/player"),s=new r,t="",u="";c.exports=k.Router.extend({routes:{"":"broadcastPage",lately:"latelyPage",broadcast:"broadcastPage",favorites:"favoritesPage",":fromPage/channel-list/:catId":"channelPage",":fromPage/program-list/:channelId":"programPage",":fromPage/play/:channelId":"playPage"},execute:function(a,b){t=u,u=window.location.hash,a&&a.apply(this,b)},navigateTo:function(a){this.navigate(a,{trigger:!0,replace:!0})},backTo:function(){t&&this.navigateTo(t.substring(1,t.length))},latelyPage:function(){h&&h.remove(),h=new m,h.mainView.footerView.player=s,this.listenTo(h.mainView.channelListView,"navigate",this.navigateTo),j("body").prepend(h.render().el),v(h.$el)},broadcastPage:function(){d||(d=new l,j("body").prepend(d.render().el)),v(d.$el)},favoritesPage:function(){i&&i.remove(),i=new n,i.mainView.footerView.player=s,this.listenTo(i.mainView.channelListView,"navigate",this.navigateTo),j("body").prepend(i.render().el),v(i.$el)},channelPage:function(a,b){e&&e.remove(),e=new o({fromPage:a,catId:b}),e.mainView.footerView.player=s,this.listenTo(e.mainView.channelListView,"navigate",this.navigateTo),j("body").prepend(e.render().el),v(e.$el)},programPage:function(a,b){f&&f.remove(),f=new p({fromPage:a,channelId:b}),this.listenTo(f.mainView,"back",this.backTo),j("body").prepend(f.render().el),v(f.$el)},playPage:function(a,b){g&&g.remove(),g=new q({fromPage:a,channelId:b,player:s}),this.listenTo(g,"back",this.backTo),j("body").prepend(g.render().el),v(g.$el)}});var v=function(a,b){var c=j(".page.active");c.length<=0&&(c=null),b=b||"right";var d=function(){a.fadeIn(200,function(){a.css("display","none"),a.addClass("active")})};switch(b){case"left":c&&c.fadeOut(200,function(){c.removeClass("active")}),d();break;case"right":c&&c.fadeOut(200,function(){c.removeClass("active")}),d()}}}),define("ekai/qtfm/1.0.0/views/broadcast/index",["backbone","underscore","ekai/qtfm/1.0.0/views/nav","ekai/qtfm/1.0.0/views/broadcast/main","jquery","store","topivi","iscroll","ekai/qtfm/1.0.0/collections/radio-category","ekai/qtfm/1.0.0/models/radio-category","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/broadcast/sub-category"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/qtfm/1.0.0/views/nav"),f=a("ekai/qtfm/1.0.0/views/broadcast/main");c.exports=d.View.extend({pageName:"broadcast",className:"page broadcast",constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.navView=new e,this.mainView=new f},render:function(){return this.$el.empty(),this.$el.append(this.navView.render().el),this.navView.activeItem(this.pageName),this.$el.append(this.mainView.render().el),this}})}),define("ekai/qtfm/1.0.0/views/nav",["backbone","underscore"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("ekai/qtfm/1.0.0/templates/nav.tpl");c.exports=d.View.extend({tagName:"ul",className:"nav",template:e.template(f),constructor:function(){d.View.apply(this,arguments)},initialize:function(){},render:function(){return this.$el.html(this.template()),this},activeItem:function(a){this.$el.find(".item.active").removeClass("active"),this.$el.find(".item."+a).addClass("active")}})}),define("ekai/qtfm/1.0.0/templates/nav.tpl",[],'<li class="item lately">\n    <a href="#lately" class="icon"></a>\n</li>\n<li class="item broadcast">\n    <a href="#broadcast" class="icon"></a>\n</li>\n<li class="item favorites">\n    <a href="#favorites" class="icon"></a>\n</li>'),define("ekai/qtfm/1.0.0/views/broadcast/main",["jquery","backbone","underscore","store","topivi","iscroll","ekai/qtfm/1.0.0/collections/radio-category","ekai/qtfm/1.0.0/models/radio-category","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/broadcast/sub-category","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("underscore"),g=a("store"),h=a("topivi"),i=a("iscroll"),j=a("ekai/qtfm/1.0.0/templates/broadcast/main.tpl"),k=a("ekai/qtfm/1.0.0/templates/loading.tpl"),l=a("ekai/qtfm/1.0.0/collections/radio-category"),m=a("ekai/qtfm/1.0.0/views/broadcast/sub-category"),n=a("ekai/qtfm/1.0.0/settings.json"),o=n.STORAGE_KEYS,p=g.get(o.all_categories);p=p||[];var q=g.get(o.civil_categories);q=q||[];var r=g.get(o.international_categories);r=r||[],c.exports=e.View.extend({className:"main no-footer",template:f.template(j),events:{"tap .categories li":"catClickEvent","tap .search-bar":"searchBarClickEvent","tap .cancel-btn":"headerSearchCancelBtnClickEvent"},constructor:function(){e.View.apply(this,arguments)},initialize:function(){this.currentCat="all",this.allCollection=new l(p),this.allCollection.url+="&id=100002",this.civilCollection=new l(q),this.civilCollection.url+="&id=9",this.internationalCollection=new l(r),this.internationalCollection.url+="&id=96"},render:function(){return this.delegateEvents(),this.$el.empty(),this.$el.html(this.template()),this.prepareData(),this},prepareData:function(){var a,b;switch(this.currentCat){case"all":a=o.all_categories,b=this.allCollection;break;case"civil":a=o.civil_categories,b=this.civilCollection;break;case"international":a=o.international_categories,b=this.internationalCollection}b.length<=0?(this.createLoadingWidget(),this.fetchSubCategories(a,b,this.renderSubCategories)):this.renderSubCategories(b)},catClickEvent:function(a){var b=d(a.currentTarget);if(!b.hasClass(this.currentCat)){b.hasClass("all")?this.currentCat="all":b.hasClass("civil")?this.currentCat="civil":b.hasClass("international")&&(this.currentCat="international");var c=this.$el.find(".sub-categories ul");c.empty(),this.prepareData()}},searchBarClickEvent:function(){var a=d("body>.mask");a.length<=0&&(d("body").append('<div class="mask"></div>'),a=d("body>.mask")),this.$el.find(".header .title").hide();var b=this.$el.find(".header-search-bar");a.fadeIn(150,function(){b.show()})},headerSearchCancelBtnClickEvent:function(){var a=this,b=d("body>.mask"),c=this.$el.find(".header-search-bar");b.fadeOut(150,function(){c.hide(),a.$el.find(".header .title").show()})},fetchSubCategories:function(a,b,c){var d=this;b.fetch({timeout:n.request_timeout,success:function(b,e){d.hideLoadingWidget(),"ok"===e.status?(g.set(a,b.toJSON()),c.call(d,b)):d.createErrorDialog()},error:function(){d.hideLoadingWidget(),d.createErrorDialog()}})},createLoadingWidget:function(){this.loadingWidget=new h.loading.normal("",{$parent:this.$el.find(".sub-categories"),noticeContent:k,iconDirection:"center",removeAfterHide:!0,autoShow:!0}),this.loadingWidget.el.addClass("qtfm")},hideLoadingWidget:function(){this.loadingWidget&&(this.loadingWidget.shown||(this.loadingWidget.shown=!0),this.loadingWidget.hide())},createErrorDialog:function(a){var b=this;a=a||"获取电台数据失败，请稍后再试...",setTimeout(function(){var c=new h.tips.normal("",{$parent:b.$el.find(".sub-categories"),removeAfterHide:!0,dependEl:b.$el,content:a,direction:"auto",autoHide:!0});c.el.addClass("error-tips"),c.show()},300)},renderSubCategories:function(a){var b=this,c=this.$el.find(".sub-categories ul");a.each(function(a){var b=new m({model:a});c.append(b.render().el)}),setTimeout(function(){b.subCategoriesScroll=new i(".page.broadcast .sub-categories",{click:!0})},100)}})}),define("ekai/qtfm/1.0.0/templates/broadcast/main.tpl",[],'<div class="header">\n    <h1 class="title">广播电台</h1>\n    <div class="header-search-bar">\n        <div class="frame">\n            <span class="icon"></span>\n            <input class="text" placeholder="请输入电台名称或频道"/>\n        </div>\n        <span class="cancel-btn">取消</span>\n    </div>\n</div>\n<div class="content">\n    <div class="search-bar">\n        <span class="icon"></span>\n        <span class="text">搜索</span>\n    </div>\n    <ul class="categories">\n        <li class="item all">\n            <div class="icon"></div>\n            <p class="label">所有</p>\n        </li>\n        <li class="item civil">\n            <div class="icon"></div>\n            <p class="label">国内台</p>\n        </li>\n        <li class="item international">\n            <div class="icon"></div>\n            <p class="label">国际台</p>\n        </li>\n    </ul>\n    <div class="sub-categories">\n        <ul class="scroller"></ul>\n    </div>\n</div>'),define("ekai/qtfm/1.0.0/templates/loading.tpl",[],'<div class="icon"></div>\n<div class="text">数据加载中，请稍候...</div>'),define("ekai/qtfm/1.0.0/collections/radio-category",["backbone","underscore","ekai/qtfm/1.0.0/models/radio-category","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("ekai/qtfm/1.0.0/models/radio-category"),g=a("ekai/qtfm/1.0.0/settings.json");c.exports=d.Collection.extend({model:f,url:g.API_URL+g.URLs.radio_category+"?app_key="+g.APP_KEY,initialize:function(){},parse:function(a){var b=[];return"ok"===a.status&&(b=e.map(a.categories,function(a){return{id:a.id,name:a.name}})),b}})}),define("ekai/qtfm/1.0.0/models/radio-category",["backbone","underscore"],function(a,b,c){var d=a("backbone");a("underscore"),c.exports=d.Model.extend({defaults:{},initialize:function(){}})}),define("ekai/qtfm/1.0.0/settings.json",[],{API_URL:"http://www.topivi.com:3001/api",APP_KEY:"d7c7ce69d618446d6a84081d62682018",STORAGE_KEYS:{all_categories:"qtfm_all_categories",civil_categories:"qtfm_civil_categories",international_categories:"qtfm_international_categories",all_channels:"qtfm_all_channels",last_played_channel:"qtfm_last_played_channel",lately_played_channels:"qtfm_lately_played_channels",favorite_channels:"qtfm_favorite_channels"},URLs:{radio_category:"/qtfm/category-list",channel_list:"/qtfm/channel-list",program_list:"/qtfm/program-list"},defaults:{thumbnail_url:"img/picture.png"},request_timeout:8e3}),define("ekai/qtfm/1.0.0/views/broadcast/sub-category",["backbone","underscore"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("ekai/qtfm/1.0.0/templates/broadcast/sub-category.tpl");c.exports=d.View.extend({tagName:"li",className:"item",template:e.template(f),constructor:function(){d.View.apply(this,arguments)},initialize:function(){},render:function(){return this.$el.html(this.template(this.model.attributes)),this}})}),define("ekai/qtfm/1.0.0/templates/broadcast/sub-category.tpl",[],'<a class="title" href="#broadcast/channel-list/{{=id}}">{{=name}}</a>'),define("ekai/qtfm/1.0.0/views/lately/index",["backbone","underscore","ekai/qtfm/1.0.0/views/nav","ekai/qtfm/1.0.0/views/lately/main","jquery","store","topivi","ekai/qtfm/1.0.0/collections/lately-channel","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","iscroll","ekai/qtfm/1.0.0/views/channel-item"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/qtfm/1.0.0/views/nav"),f=a("ekai/qtfm/1.0.0/views/lately/main");c.exports=d.View.extend({pageName:"lately",className:"page lately",constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.navView=new e,this.mainView=new f({fromPage:this.pageName})},render:function(){return this.$el.empty(),this.$el.append(this.navView.render().el),this.navView.activeItem(this.pageName),this.$el.append(this.mainView.render().el),this}})}),define("ekai/qtfm/1.0.0/views/lately/main",["jquery","backbone","underscore","store","topivi","ekai/qtfm/1.0.0/collections/lately-channel","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","iscroll","ekai/qtfm/1.0.0/views/channel-item","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("underscore"),g=a("store"),h=a("topivi"),i=a("ekai/qtfm/1.0.0/templates/lately/main.tpl"),j=a("ekai/qtfm/1.0.0/collections/lately-channel"),k=a("ekai/qtfm/1.0.0/views/footer-play"),l=a("ekai/qtfm/1.0.0/views/channel-list"),m=a("ekai/qtfm/1.0.0/settings.json"),n=m.STORAGE_KEYS;c.exports=e.View.extend({className:"main",template:f.template(i),events:{"tap .header .clear":"clearAllClickEvent","swipeleft .listview>.item":"itemSwipeLeftEvent","swiperight .listview>.item":"itemSwipeRightEvent"},constructor:function(){e.View.apply(this,arguments)},initialize:function(a){this.pageName=a.fromPage,this.collection=new j,this.channelListView=new l({collection:this.collection,scrollSelector:".page.lately>.main>.content"}),this.footerView=new k({fromPage:this.pageName}),this.listenTo(this.collection,"remove",this.removeItemEvent)},render:function(){return this.$el.empty(),this.$el.html(this.template({title:"最近收听"})),this.renderChannels(),this},renderChannels:function(){var a=g.get(n.lately_played_channels);a=a||{},a=f.values(a),this.collection.reset(a),this.channelListView.pageName=this.pageName,this.$el.find(">.content").append(this.channelListView.render().el),this.$el.find(">.footer").append(this.footerView.render().el)},clearAllClickEvent:function(){if(!(this.collection.length<=0)){var a=this,b=new h.dialog.confirm("",{content:"你确定要删除所有收听记录吗？",onOkClick:function(){o(),a.footerView.stopPlay(),a.render()},removeAfterClose:!0,useMask:!0,closeGesture:"clickmask"});b.el.addClass("qtfm"),b.open()}},itemSwipeLeftEvent:function(a){var b=d(a.currentTarget);b.hasClass("deleting")||(b.addClass("deleting"),b.append("<div class='delete-btn'></div>"),b.find(".delete-btn").fadeIn(300))},itemSwipeRightEvent:function(a){var b=d(a.currentTarget);b.hasClass("deleting")&&(b.removeClass("deleting"),b.find(".delete-btn").remove())},removeItemEvent:function(a){q(a.id),a.id===this.footerView.model.id&&(p(),this.footerView.stopPlay(),this.footerView.render())}});var o=function(){g.remove(n.last_played_channel),g.remove(n.lately_played_channels)},p=function(){g.remove(n.last_played_channel)},q=function(a){var b=g.get(n.lately_played_channels);b=b||{},b[a]=void 0,g.set(n.lately_played_channels,b)}}),define("ekai/qtfm/1.0.0/templates/lately/main.tpl",[],'<div class="header">\n    <h1 class="title">{{=title}}</h1>\n    <span class="clear">清空</span>\n</div>\n<div class="content">\n\n</div>\n<div class="footer">\n\n</div>'),define("ekai/qtfm/1.0.0/collections/lately-channel",["backbone","underscore","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){a("backbone"),a("underscore");var d=a("ekai/qtfm/1.0.0/collections/channel");a("ekai/qtfm/1.0.0/settings.json"),c.exports=d.extend({comparator:function(a,b){return a.get("listenDate")<b.get("listenDate")},initialize:function(){}})}),define("ekai/qtfm/1.0.0/collections/channel",["backbone","underscore","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/qtfm/1.0.0/models/channel"),f=a("ekai/qtfm/1.0.0/settings.json");c.exports=d.Collection.extend({model:e,url:f.API_URL+f.URLs.channel_list+"?app_key="+f.APP_KEY,initialize:function(){},parse:function(a){var b=[];return"ok"===a.status&&(b=a.channels),b}})}),define("ekai/qtfm/1.0.0/models/channel",["backbone","underscore","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("ekai/qtfm/1.0.0/settings.json");c.exports=d.Model.extend({url:f.API_URL+f.URLs.program_list+"?app_key="+f.APP_KEY,defaults:{},initialize:function(){},parse:function(a){if(a.id)return g(a);var b={};return"ok"===a.status&&(b=g(a.channel)),b},getTodayPrograms:function(){var a=[],b=this.get("programs");if(b&&!e.isEmpty(b)){var c=new Date,d=c.getDay();0===d&&(d=7),b[d]&&(a=b[d])}return a},getNowProgram:function(){var a=this.getTodayPrograms();if(a.length<=0)return{};var b=(new Date).getTime(),c=e.find(a,function(a){var c,d,e=a.broadcasttime,f=parseInt(a.duration),g=e.split(":");if(g.length<2)return console.error("Data broadcasttime is invalid."),!1;g.length>2?(c=g[g.length-2],d=g[g.length-1]):(c=g[0],d=g[1]);var h=new Date;h.setHours(c),h.setMinutes(d),h.setSeconds(0);var i=new Date(h.getTime()+1e3*f);return b>=h.getTime()&&b<=i.getTime()});return c=c||{}},getNowProgramProgress:function(){var a=this.getNowProgram(),b={current:0,max:0};if(!e.isEmpty(a)){var c=a.broadcasttime,d=parseInt(a.duration),f=c.split(":"),g=parseInt(f[0]),h=parseInt(f[1]),i=new Date;i.setHours(g),i.setMinutes(h),i.setSeconds(0);var j=new Date,k=j.getTime()-i.getTime();b.current=parseInt(k/1e3),b.max=d}return b}});var g=function(a){return{id:a.id,name:a.name,desc:a.desc?a.desc:"",frequency:a.frequency,mediaId:a.mediainfo.id,mediaSrc:i(a.mediainfo.id),catId:a.catid,thumbnail:a.pic?a.pic:"",programs:a.programs?h(a.programs):{}}},h=function(a){var b={};return e.each(a,function(a){b[a.dayofweek]=a.programs}),b},i=function(a){return"http://http.qingting.fm/"+a+".mp3"}}),define("ekai/qtfm/1.0.0/views/footer-play",["backbone","underscore","topivi","store","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/models/channel"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("topivi"),g=a("store"),h=a("ekai/qtfm/1.0.0/templates/footer-play.tpl"),i=a("ekai/qtfm/1.0.0/settings.json"),j=i.STORAGE_KEYS,k=a("ekai/qtfm/1.0.0/models/channel");c.exports=d.View.extend({className:"footer-play",template:e.template(h),events:{"tap .play-btn":"playBtnClickEvent"},constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.pageName=a.fromPage,this.model=new k},render:function(){var a=this,b=g.get(j.last_played_channel);b=b||{},this.model.clear(),this.model.set(b),this.$el.empty(),this.$el.html(this.template({pageName:this.pageName,channel:this.model.attributes,isPlaying:this.player.isPlaying}));var c=this.$el.find(".play-progress");return this.playProgress=new f.progress.line(c,{onEnd:function(){console.log("end")}}),this.model.id&&(this.player.cut(this.model.get("mediaSrc")),this.player.addRunnable({name:"footer-play",fn:function(){a.progressRunnable()}}),this.progressRunnable()),this},progressRunnable:function(){var a=this.model.getNowProgramProgress();this.playProgress.options.max=a.max,this.playProgress.setProgress(a.current)},playBtnClickEvent:function(a){if(this.model.id){var b=d.$(a.currentTarget);b.hasClass("playing")?this.player.pause():this.player.play(),b.toggleClass("playing")}},stopPlay:function(){this.player.stop(),this.$el.find(".play-btn").removeClass("playing")}})}),define("ekai/qtfm/1.0.0/templates/footer-play.tpl",[],'<div class="wrapper">\n    {{\n        if (channel.id) {\n    }}\n    <a class="show-program-list" href="#{{=pageName}}/program-list/{{=channel.id}}"></a>\n    <a class="channel-title" href="#{{=pageName}}/play/{{=channel.id}}">{{=channel.name}}</a>\n    {{\n        } else {\n    }}\n    <a class="show-program-list"></a>\n    <p class="channel-title"></p>\n    {{\n        }\n    }}\n    <div class="play-btn {{=isPlaying ? \'playing\' : \'\'}}"></div>\n</div>\n<div class="play-progress"></div>'),define("ekai/qtfm/1.0.0/views/channel-list",["backbone","underscore","iscroll","ekai/qtfm/1.0.0/views/channel-item","store","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("iscroll"),f=a("ekai/qtfm/1.0.0/views/channel-item");c.exports=d.View.extend({tagName:"ul",className:"channel-list listview",constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.scrollSelector=a.scrollSelector,this.listenTo(this.collection,"remove",this.removeItemEvent)},render:function(){var a=this;return this.$el.empty(),this.collection.each(function(b){b.set("pageName",a.pageName);var c=new f({model:b,parent:a});a.$el.append(c.render().el)}),setTimeout(function(){a.listScroll=new e(a.scrollSelector,{click:!0})},250),this},removeItemEvent:function(){this.listScroll.refresh()}})}),define("ekai/qtfm/1.0.0/views/channel-item",["backbone","underscore","store","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("store"),g=a("ekai/qtfm/1.0.0/templates/channel-item.tpl"),h=a("ekai/qtfm/1.0.0/settings.json"),i=h.STORAGE_KEYS;c.exports=d.View.extend({tagName:"li",className:"item",template:e.template(g),events:{"tap .link":"linkClickEvent","tap .delete-btn":"deleteBtnClick"},constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.parentView=a.parent},render:function(){return this.$el.html(this.template(this.model.attributes)),this},linkClickEvent:function(){var a=this.model.toJSON();a.pageName=void 0,f.set(i.last_played_channel,a);var b=f.get(i.lately_played_channels);b=b||{},a.listenDate=(new Date).getTime(),b[a.id]=a,f.set(i.lately_played_channels,b);var c=this.model.get("pageName")+"/play/"+this.model.id;this.parentView.trigger("navigate",c)},deleteBtnClick:function(){this.remove(),this.parentView.collection.remove(this.model)}})}),define("ekai/qtfm/1.0.0/templates/channel-item.tpl",[],'<a class="link">\n    <h2 class="title">{{=name}}</h2>\n    <p class="desc">{{=desc}}</p>\n    {{\n        if (frequency) {\n    }}\n    <span class="mark frequency">FM {{=(frequency.indexOf(\'FM\') >= 0 || frequency.indexOf(\'fm\') >= 0) ? frequency.substr(0, 2) : frequency}}</span>\n    {{\n        }\n    }}\n</a>'),define("ekai/qtfm/1.0.0/views/favorites/index",["backbone","underscore","ekai/qtfm/1.0.0/views/nav","ekai/qtfm/1.0.0/views/favorites/main","jquery","store","topivi","ekai/qtfm/1.0.0/collections/favorites-channel","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","iscroll","ekai/qtfm/1.0.0/views/channel-item"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/qtfm/1.0.0/views/nav"),f=a("ekai/qtfm/1.0.0/views/favorites/main");c.exports=d.View.extend({pageName:"favorites",className:"page favorites",constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.navView=new e,this.mainView=new f({fromPage:this.pageName})},render:function(){return this.$el.empty(),this.$el.append(this.navView.render().el),this.navView.activeItem(this.pageName),this.$el.append(this.mainView.render().el),this}})}),define("ekai/qtfm/1.0.0/views/favorites/main",["jquery","backbone","underscore","store","topivi","ekai/qtfm/1.0.0/collections/favorites-channel","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","iscroll","ekai/qtfm/1.0.0/views/channel-item","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("underscore"),g=a("store"),h=a("topivi"),i=a("ekai/qtfm/1.0.0/templates/favorites/main.tpl"),j=a("ekai/qtfm/1.0.0/collections/favorites-channel"),k=a("ekai/qtfm/1.0.0/views/footer-play"),l=a("ekai/qtfm/1.0.0/views/channel-list"),m=a("ekai/qtfm/1.0.0/settings.json"),n=m.STORAGE_KEYS;c.exports=e.View.extend({className:"main",template:f.template(i),events:{"tap .header .clear":"clearAllClickEvent","swipeleft .listview>.item":"itemSwipeLeftEvent","swiperight .listview>.item":"itemSwipeRightEvent"},constructor:function(){e.View.apply(this,arguments)},initialize:function(a){this.pageName=a.fromPage,this.collection=new j,this.channelListView=new l({collection:this.collection,scrollSelector:".page.favorites>.main>.content"}),this.footerView=new k({fromPage:this.pageName}),this.listenTo(this.collection,"remove",this.removeItemEvent)},render:function(){return this.$el.empty(),this.$el.html(this.template({title:"我的收藏"})),this.renderChannels(),this},renderChannels:function(){var a=g.get(n.favorite_channels);a=a||{},a=f.values(a),this.collection.reset(a),this.channelListView.pageName=this.pageName,this.$el.find(">.content").append(this.channelListView.render().el),this.$el.find(">.footer").append(this.footerView.render().el)},clearAllClickEvent:function(){if(!(this.collection.length<=0)){var a=this,b=new h.dialog.confirm("",{content:"你确定要删除所有收藏记录吗？",onOkClick:function(){o(),a.render()},removeAfterClose:!0,useMask:!0,closeGesture:"clickmask"});b.el.addClass("qtfm"),b.open()}},itemSwipeLeftEvent:function(a){var b=d(a.currentTarget);b.hasClass("deleting")||(b.addClass("deleting"),b.append("<div class='delete-btn'></div>"),b.find(".delete-btn").fadeIn(300))},itemSwipeRightEvent:function(a){var b=d(a.currentTarget);b.hasClass("deleting")&&(b.removeClass("deleting"),b.find(".delete-btn").remove())},removeItemEvent:function(a){p(a.id)}});var o=function(){g.remove(n.favorite_channels)},p=function(a){var b=g.get(n.favorite_channels);b=b||{},b[a]=void 0,g.set(n.favorite_channels,b)}}),define("ekai/qtfm/1.0.0/templates/favorites/main.tpl",[],'<div class="header">\n    <h1 class="title">{{=title}}</h1>\n    <span class="clear">清空</span>\n</div>\n<div class="content">\n\n</div>\n<div class="footer">\n\n</div>'),define("ekai/qtfm/1.0.0/collections/favorites-channel",["backbone","underscore","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){a("backbone"),a("underscore");var d=a("ekai/qtfm/1.0.0/collections/channel");a("ekai/qtfm/1.0.0/settings.json"),c.exports=d.extend({comparator:function(a,b){return a.get("favoriteDate")<b.get("favoriteDate")},initialize:function(){}})}),define("ekai/qtfm/1.0.0/views/channel/index",["backbone","underscore","ekai/qtfm/1.0.0/views/nav","ekai/qtfm/1.0.0/views/channel/main","jquery","store","topivi","iscroll","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","ekai/qtfm/1.0.0/views/channel-item"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/qtfm/1.0.0/views/nav"),f=a("ekai/qtfm/1.0.0/views/channel/main");c.exports=d.View.extend({className:"page channel",constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.pageName=a.fromPage,this.navView=new e,this.mainView=new f(a)},resetCategoryId:function(a){this.mainView.catId=a},render:function(){return this.$el.empty(),this.$el.append(this.navView.render().el),this.navView.activeItem(this.pageName),this.$el.append(this.mainView.render().el),this}})}),define("ekai/qtfm/1.0.0/views/channel/main",["jquery","backbone","underscore","store","topivi","iscroll","ekai/qtfm/1.0.0/collections/channel","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/views/footer-play","ekai/qtfm/1.0.0/views/channel-list","ekai/qtfm/1.0.0/views/channel-item","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){a("jquery");var d=a("backbone"),e=a("underscore"),f=a("store"),g=a("topivi");a("iscroll");var h=a("ekai/qtfm/1.0.0/templates/channel/main.tpl"),i=a("ekai/qtfm/1.0.0/templates/loading.tpl"),j=a("ekai/qtfm/1.0.0/collections/channel"),k=a("ekai/qtfm/1.0.0/views/footer-play"),l=a("ekai/qtfm/1.0.0/views/channel-list"),m=a("ekai/qtfm/1.0.0/settings.json"),n=m.STORAGE_KEYS;c.exports=d.View.extend({className:"main",template:e.template(h),events:{},constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.catId=a.catId,this.pageName=a.fromPage,this.currentPage=1,this.pageSize=50,this.collection=new j,this.channelListView=new l({collection:this.collection,scrollSelector:".page.channel>.main>.content"}),this.footerView=new k({fromPage:this.pageName})},render:function(){this.delegateEvents(),this.$el.empty();var a=o(this.catId);this.$el.html(this.template({title:a.name,pageName:this.pageName}));var b=f.get(n.all_channels);return b=b||{},b[this.catId]?(this.collection.reset(b[this.catId]),this.renderChannels()):(this.createLoadingWidget(),this.fetchChannels(this.renderChannels)),this.$el.find(">.footer").append(this.footerView.render().el),this},fetchChannels:function(a){var b=this;this.collection.fetch({timeout:m.request_timeout,data:{id:this.catId,curpage:this.currentPage,pagesize:this.pageSize},success:function(c,d){if(b.hideLoadingWidget(),"ok"===d.status){var e=f.get(n.all_channels);e=e||{},e[b.catId]=c.toJSON(),f.set(n.all_channels,e),a.call(b)}else b.createErrorDialog()},error:function(){b.hideLoadingWidget(),b.createErrorDialog()
}})},renderChannels:function(){this.channelListView.pageName=this.pageName,this.$el.find(">.content").append(this.channelListView.render().el)},createLoadingWidget:function(){this.loadingWidget=new g.loading.normal("",{$parent:this.$el.find(">.content"),noticeContent:i,iconDirection:"center",removeAfterHide:!0,autoShow:!0}),this.loadingWidget.el.addClass("qtfm")},hideLoadingWidget:function(){this.loadingWidget&&(this.loadingWidget.shown||(this.loadingWidget.shown=!0),this.loadingWidget.hide())},createErrorDialog:function(a){var b=this;a=a||"获取频道数据失败，请稍后再试...",setTimeout(function(){var c=new g.tips.normal("",{$parent:b.$el.find(">.content"),removeAfterHide:!0,dependEl:b.$el,content:a,direction:"auto",autoHide:!0});c.el.addClass("error-tips"),c.show()},300)}});var o=function(a){a=parseInt(a);var b=null,c=f.get(n.all_categories);if(c=c||[],b=e.findWhere(c,{id:a}))return b;var d=f.get(n.civil_categories);if(d=d||[],b=e.findWhere(d,{id:a}))return b;var g=f.get(n.international_categories);return g=g||[],b=e.findWhere(g,{id:a}),b?b:""}}),define("ekai/qtfm/1.0.0/templates/channel/main.tpl",[],'<div class="header">\n    <h1 class="title">{{=title}}</h1>\n    <a class="back-btn" href="#{{=pageName}}"></a>\n</div>\n<div class="content">\n\n</div>\n<div class="footer">\n\n</div>'),define("ekai/qtfm/1.0.0/views/program/index",["backbone","underscore","ekai/qtfm/1.0.0/views/nav","ekai/qtfm/1.0.0/views/program/main","jquery","store","topivi","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/collections/program","ekai/qtfm/1.0.0/models/program","ekai/qtfm/1.0.0/views/program/program-list","iscroll","ekai/qtfm/1.0.0/views/program/program-item","ekai/qtfm/1.0.0/util"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/qtfm/1.0.0/views/nav"),f=a("ekai/qtfm/1.0.0/views/program/main");c.exports=d.View.extend({className:"page program",constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.pageName=a.fromPage,this.navView=new e,this.mainView=new f(a)},render:function(){return this.$el.empty(),this.$el.append(this.navView.render().el),this.navView.activeItem(this.pageName),this.$el.append(this.mainView.render().el),this}})}),define("ekai/qtfm/1.0.0/views/program/main",["jquery","backbone","underscore","store","topivi","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/collections/program","ekai/qtfm/1.0.0/models/program","ekai/qtfm/1.0.0/views/program/program-list","iscroll","ekai/qtfm/1.0.0/views/program/program-item","ekai/qtfm/1.0.0/util","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("underscore"),g=a("store"),h=a("topivi"),i=a("ekai/qtfm/1.0.0/templates/program/main.tpl"),j=a("ekai/qtfm/1.0.0/templates/loading.tpl"),k=a("ekai/qtfm/1.0.0/models/channel"),l=a("ekai/qtfm/1.0.0/collections/program"),m=a("ekai/qtfm/1.0.0/views/program/program-list"),n=a("ekai/qtfm/1.0.0/settings.json"),o=n.STORAGE_KEYS;c.exports=e.View.extend({className:"main no-footer",template:f.template(i),events:{"tap .add-favorite":"addFavoriteBtnClickEvent","tap .back-btn":"backBtnClickEvent"},constructor:function(){e.View.apply(this,arguments)},initialize:function(a){this.channelId=a.channelId,this.pageName=a.fromPage,this.day="1,2,3,4,5,6,7",this.model=new k,this.collection=new l,this.programListView=new m({currentChannel:this.model,scrollSelector:".page.program .listview-wrapper"})},render:function(){this.delegateEvents(),this.$el.empty();var a=p(this.channelId);a=a||{},this.model.clear(),this.model.set(a);var b=r(this.channelId);this.$el.html(this.template({title:this.model.get("name"),isFavorite:b?!0:!1}));var c=this.model.getTodayPrograms();return!c||c.length<=0?(this.createLoadingWidget(),this.fetchPrograms(this.renderPrograms)):this.renderPrograms(),this},addFavoriteBtnClickEvent:function(a){var b=d(a.currentTarget),c=r(this.channelId);c?(t(this.channelId),b.removeClass("added")):(s(this.model.toJSON()),b.addClass("added"))},backBtnClickEvent:function(){this.trigger("back")},fetchPrograms:function(a){var b=this;this.model.fetch({timeout:n.request_timeout,data:{id:this.channelId,day:this.day},success:function(c,d){b.hideLoadingWidget(),"ok"===d.status?(q(c.toJSON()),a.call(b)):b.createErrorDialog()},error:function(){b.hideLoadingWidget(),b.createErrorDialog()}})},renderPrograms:function(){var a=this.model.getTodayPrograms();this.collection.reset(a),this.programListView.collection=this.collection,this.programListView.pageName=this.pageName,this.$el.find(">.content .count-label .value").text(this.collection.length),this.$el.find(">.content .listview-wrapper").append(this.programListView.render().el)},createLoadingWidget:function(){this.loadingWidget=new h.loading.normal("",{$parent:this.$el.find(">.content"),noticeContent:j,iconDirection:"center",removeAfterHide:!0,autoShow:!0}),this.loadingWidget.el.addClass("qtfm")},hideLoadingWidget:function(){this.loadingWidget&&(this.loadingWidget.shown||(this.loadingWidget.shown=!0),this.loadingWidget.hide())},createErrorDialog:function(a){var b=this;a=a||"获取频道数据失败，请稍后再试...",setTimeout(function(){var c=new h.tips.normal("",{$parent:b.$el.find(">.content"),removeAfterHide:!0,dependEl:b.$el,content:a,direction:"auto",autoHide:!0});c.el.addClass("error-tips"),c.show()},300)}});var p=function(a){var b=g.get(o.lately_played_channels);return b=b||{},b[a]},q=function(a){var b=g.get(o.lately_played_channels);b=b||{},a.listenDate=(new Date).getTime(),b[a.id]=a,g.set(o.lately_played_channels,b)},r=function(a){var b=g.get(o.favorite_channels);return b=b||{},b[a]},s=function(a){var b=g.get(o.favorite_channels);b=b||{},a.favoriteDate=(new Date).getTime(),b[a.id]=a,g.set(o.favorite_channels,b)},t=function(a){var b=g.get(o.favorite_channels);b=b||{},b[a]=void 0,g.set(o.favorite_channels,b)}}),define("ekai/qtfm/1.0.0/templates/program/main.tpl",[],'<div class="header">\n    <h1 class="title">{{=title}}</h1>\n    <a class="back-btn"></a>\n    <a class="add-favorite {{=isFavorite ? \'added\' : \'\'}}"></a>\n</div>\n<div class="content">\n    <div class="count-label">\n        <p class="wrapper">节目列表（<span class="value"></span>条）</p>\n    </div>\n    <div class="listview-wrapper"></div>\n</div>'),define("ekai/qtfm/1.0.0/collections/program",["backbone","underscore","ekai/qtfm/1.0.0/models/program"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/qtfm/1.0.0/models/program");c.exports=d.Collection.extend({model:e,initialize:function(){}})}),define("ekai/qtfm/1.0.0/models/program",["backbone","underscore"],function(a,b,c){var d=a("backbone");a("underscore"),c.exports=d.Model.extend({defaults:{},initialize:function(){}})}),define("ekai/qtfm/1.0.0/views/program/program-list",["backbone","underscore","iscroll","ekai/qtfm/1.0.0/views/program/program-item","ekai/qtfm/1.0.0/util"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("iscroll"),f=a("ekai/qtfm/1.0.0/views/program/program-item");c.exports=d.View.extend({tagName:"ul",className:"program-list listview",constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.channelModel=a.currentChannel,this.scrollSelector=a.scrollSelector},render:function(){var a=this;this.$el.empty();var b=this.channelModel.getNowProgram(),c=null;return this.collection.each(function(d){d.set("pageName",a.pageName);var e=new f({model:d});a.$el.append(e.render().el),b.id===d.id&&(c=e)}),setTimeout(function(){a.listScroll=new e(a.scrollSelector,{click:!0}),c&&(a.listScroll.scrollToElement(c.el,800),c.$el.addClass("current"))},250),this}})}),define("ekai/qtfm/1.0.0/views/program/program-item",["backbone","underscore","ekai/qtfm/1.0.0/util"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("ekai/qtfm/1.0.0/templates/program/program-item.tpl"),g=a("ekai/qtfm/1.0.0/util");c.exports=d.View.extend({tagName:"li",className:"item",template:e.template(f),constructor:function(){d.View.apply(this,arguments)},initialize:function(){},render:function(){return this.$el.html(this.template({program:this.model.attributes,util:g})),this}})}),define("ekai/qtfm/1.0.0/templates/program/program-item.tpl",[],"{{\n    var updateTimeDiff = util.parseTimeDiff(program.updatetime);\n    var updateTimeDiffStr = '';\n    switch (updateTimeDiff.unit) {\n        case 's':\n            updateTimeDiffStr = updateTimeDiff.num + '秒前更新';\n            break;\n        case 'm':\n            updateTimeDiffStr = updateTimeDiff.num + '分钟前更新';\n            break;\n        case 'h':\n            updateTimeDiffStr = updateTimeDiff.num + '小时前更新';\n            break;\n        default:\n            var date = new Date(program.updatetime * 1000);\n            updateTimeDiffStr = (date.getMonth() + 1) + '月' + date.getDate() + '日更新';\n            break;\n    }\n    var duringTimeStr = util.parseTime(program.duration);\n}}\n<a class=\"link\">\n    <h2 class=\"title\">{{=program.name}}</h2>\n    <p class=\"desc update-time\">{{=updateTimeDiffStr}}</p>\n    <span class=\"mark duration\">\n        {{=program.broadcasttime}} / {{=duringTimeStr.h > 0 ? duringTimeStr.h + '小时' : ''}}{{=duringTimeStr.m > 0 || duringTimeStr.s ? duringTimeStr.m + '分' : ''}}{{=duringTimeStr.s > 0 ? duringTimeStr.s + '秒' : ''}}\n    </span>\n</a>"),define("ekai/qtfm/1.0.0/util",[],function(a,b){b.parseTimeDiff=function(a){var b=(new Date).getTime(),c=parseInt(b/1e3)-a,d=c;if(60>d)return{num:d,unit:"s"};if(d=parseInt(d/60),60>d)return{num:d,unit:"m"};if(d=parseInt(d/60),24>d)return{num:d,unit:"h"};if(d=parseInt(d/24),7>d)return{num:d,unit:"d"};var e=parseInt(d/7);return 4>e?{num:e,unit:"w"}:(d=parseInt(d/30),12>d?{num:d,unit:"mon"}:(d=parseInt(d/12),{num:d,unit:"y"}))},b.parseTime=function(a){var b=a/3600;b>0&&(b=parseInt(b),a%=3600);var c=a/60;return c>0&&(c=parseInt(c),a%=60),{h:b,m:c,s:a}}}),define("ekai/qtfm/1.0.0/views/play/index",["backbone","jquery","underscore","store","topivi","ekai/qtfm/1.0.0/util","ekai/qtfm/1.0.0/models/channel","ekai/qtfm/1.0.0/settings.json","ekai/qtfm/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("jquery"),f=a("underscore"),g=a("store"),h=a("topivi"),i=a("ekai/qtfm/1.0.0/util"),j=a("ekai/qtfm/1.0.0/templates/play/main.tpl"),k=a("ekai/qtfm/1.0.0/models/channel"),l=a("ekai/qtfm/1.0.0/settings.json"),m=l.STORAGE_KEYS;c.exports=d.View.extend({className:"page play",template:f.template(j),events:{"tap .back-btn":"backBtnClickEvent","tap .play-btn":"playBtnClickEvent","tap .add-favorite":"addFavoriteBtnClickEvent"},constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.player=a.player,this.pageName=a.fromPage,this.day="1,2,3,4,5,6,7",this.channelId=a.channelId,this.model=new k},render:function(){var a=this;this.$el.empty();var b=g.get(m.last_played_channel);this.model.clear(),this.model.set(b);var c=o(this.channelId);this.$el.html(this.template({pageName:this.pageName,channel:this.model.attributes,isPlaying:!0,isFavorite:c?!0:!1,defaultThumbnail:l.defaults.thumbnail_url}));var d=this.$el.find(".play-progress");this.playProgress=new h.progress.line(d,{onEnd:function(){console.log("end")}}),this.player.cut(this.model.get("mediaSrc")),this.player.addRunnable({name:"play-page",fn:function(){a.progressRunnable()}}),this.player.play(),this.progressRunnable();var e=this.model.getTodayPrograms();return!e||e.length<=0?this.fetchPrograms(this.renderProgram):this.renderProgram(),this},fetchPrograms:function(a){var b=this;this.model.fetch({timeout:l.request_timeout,data:{id:this.channelId,day:this.day},success:function(c,d){"ok"===d.status&&(n(c.toJSON()),a.call(b))}})},renderProgram:function(){var a=this.model.getNowProgram(),b=a&&!f.isEmpty(a)?a.name:"暂无节目";this.$el.find(">.content .current-program").text(b)},progressRunnable:function(){var a=this.model.getNowProgramProgress();this.playProgress.options.max=a.max,this.playProgress.setProgress(a.current);var b=i.parseTime(a.max),c=i.parseTime(a.current);this.$el.find(">.content .text .played").text(c.h+":"+(c.m>9?c.m:"0"+c.m)+":"+(c.s>9?c.s:"0"+c.s)),this.$el.find(">.content .text .account").text(b.h+":"+(b.m>9?b.m:"0"+b.m)+":"+(b.s>9?b.s:"0"+b.s))},backBtnClickEvent:function(){this.trigger("back")},playBtnClickEvent:function(a){var b=d.$(a.currentTarget);b.hasClass("playing")?this.player.pause():this.player.play(),b.toggleClass("playing")},addFavoriteBtnClickEvent:function(a){var b=e(a.currentTarget),c=o(this.channelId);c?(q(this.channelId),b.removeClass("added")):(p(this.model.toJSON()),b.addClass("added"))}});var n=function(a){g.set(m.last_played_channel,a);var b=g.get(m.lately_played_channels);b=b||{},a.listenDate=(new Date).getTime(),b[a.id]=a,g.set(m.lately_played_channels,b)},o=function(a){var b=g.get(m.favorite_channels);return b=b||{},b[a]},p=function(a){var b=g.get(m.favorite_channels);b=b||{},a.favoriteDate=(new Date).getTime(),b[a.id]=a,g.set(m.favorite_channels,b)},q=function(a){var b=g.get(m.favorite_channels);b=b||{},b[a]=void 0,g.set(m.favorite_channels,b)}}),define("ekai/qtfm/1.0.0/templates/play/main.tpl",[],'<div class="header">\n    <a class="back-btn"></a>\n</div>\n<div class="content">\n    <div class="wrapper">\n        <img class="thumbnail" src="{{=channel.thumbnail || defaultThumbnail}}"/>\n        <p class="current-program"></p>\n        <div class="program-progress">\n            <div class="play-progress">\n            </div>\n            <div class="text">\n                <span class="played">01:10</span>\n                <span class="account">04:20</span>\n            </div>\n        </div>\n        <div class="btns">\n            <span class="prev"></span>\n            <span class="play-btn {{=isPlaying ? \'playing\' : \'\'}}"></span>\n            <span class="next"></span>\n        </div>\n    </div>\n</div>\n<div class="footer">\n    <p class="title">{{=channel.name}}{{\n        if (channel.frequency) {\n        }}\n        <span class="mark frequency">FM {{=(channel.frequency.indexOf(\'FM\') >= 0 || channel.frequency.indexOf(\'fm\') >= 0) ? channel.frequency.substr(0, 2) : channel.frequency}}</span>\n        {{\n        }\n        }}</p>\n    <a class="show-program-list" href="#{{=pageName}}/program-list/{{=channel.id}}"></a>\n    <span class="add-favorite {{=isFavorite ? \'added\' : \'\'}}"></span>\n</div>'),define("ekai/qtfm/1.0.0/player",["underscore"],function(a,b,c){function d(a){a=a||{};var b={onEnd:function(){}};e.extend(this,b,a),this.init()}var e=a("underscore");d.prototype.init=function(){var a=this;this.audio=document.createElement("audio"),this.audio.addEventListener("ended",function(){a.onEnd.apply(a,arguments)}),this.isPlaying=!1,this.interval=null,this.runnables={}},d.prototype.play=function(){this.isPlaying||(this.isPlaying=!0,this.audio.play(),this.startInterval())},d.prototype.pause=function(){this.isPlaying&&(this.isPlaying=!1,this.audio.pause(),this.clearInterval())},d.prototype.stop=function(){this.src&&(this.audio.currentTime=0),this.pause()},d.prototype.cut=function(a){a!==this.src&&(this.src=a,this.audio.src=a,this.isPlaying&&(this.pause(),this.play()))},d.prototype.addRunnable=function(a){var b=a.name;this.disableRunnable(b),this.runnables[b]=a.fn},d.prototype.disableRunnable=function(a){this.runnables[a]&&(this.runnables[a]=void 0)},d.prototype.startInterval=function(){var a=this,b=1e3;this.interval=setInterval(function(){for(var b in a.runnables){var c=a.runnables[b];c()}},b)},d.prototype.clearInterval=function(){clearInterval(this.interval)},c.exports=d});
