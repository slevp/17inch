define("ekai/app-store/1.0.0/index",["./main","backbone","./routers/index","./views/home","underscore","./views/nav","store","topivi","iscroll","./templates/nav.tpl","./collections/category","./models/category","./settings.json","./views/main","./views/content","./templates/content.tpl","./collections/app","./models/app","./views/app-item","./templates/app-item.tpl","./views/app-detail","./templates/app-detail.tpl"],function(a,b,c){c.exports=a("./main")}),define("ekai/app-store/1.0.0/main",["backbone","ekai/app-store/1.0.0/routers/index","ekai/app-store/1.0.0/views/home","underscore","ekai/app-store/1.0.0/views/nav","store","topivi","iscroll","ekai/app-store/1.0.0/collections/category","ekai/app-store/1.0.0/models/category","ekai/app-store/1.0.0/settings.json","ekai/app-store/1.0.0/views/main","ekai/app-store/1.0.0/views/content","ekai/app-store/1.0.0/collections/app","ekai/app-store/1.0.0/models/app","ekai/app-store/1.0.0/views/app-item","ekai/app-store/1.0.0/views/app-detail"],function(a){var b=a("backbone"),c=a("ekai/app-store/1.0.0/routers/index");new c,b.history.start()}),define("ekai/app-store/1.0.0/routers/index",["backbone","ekai/app-store/1.0.0/views/home","underscore","ekai/app-store/1.0.0/views/nav","store","topivi","iscroll","ekai/app-store/1.0.0/collections/category","ekai/app-store/1.0.0/models/category","ekai/app-store/1.0.0/settings.json","ekai/app-store/1.0.0/views/main","ekai/app-store/1.0.0/views/content","ekai/app-store/1.0.0/collections/app","ekai/app-store/1.0.0/models/app","ekai/app-store/1.0.0/views/app-item","ekai/app-store/1.0.0/views/app-detail"],function(a,b,c){var d=a("backbone"),e=a("ekai/app-store/1.0.0/views/home"),f=null;c.exports=d.Router.extend({routes:{"":"homePage"},homePage:function(a){a=a||"all",f||(f=new e),d.$("body").prepend(f.render().el)}})}),define("ekai/app-store/1.0.0/views/home",["backbone","underscore","ekai/app-store/1.0.0/views/nav","store","topivi","iscroll","ekai/app-store/1.0.0/collections/category","ekai/app-store/1.0.0/models/category","ekai/app-store/1.0.0/settings.json","ekai/app-store/1.0.0/views/main","ekai/app-store/1.0.0/views/content","ekai/app-store/1.0.0/collections/app","ekai/app-store/1.0.0/models/app","ekai/app-store/1.0.0/views/app-item","ekai/app-store/1.0.0/views/app-detail"],function(a,b,c){var d=a("backbone");a("underscore");var e=a("ekai/app-store/1.0.0/views/nav"),f=a("ekai/app-store/1.0.0/views/main");c.exports=d.View.extend({className:"page",constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.navView=new e,this.mainView=new f,this.mainView.contentView.listenTo(this.navView,"changeCategory",this.mainView.contentView.changeCategory)},render:function(){return this.$el.empty(),this.$el.append("<div id='app-detail-dialog'></div>"),this.$el.append(this.mainView.render().el),this.$el.append("<div id='bottom-mask'></div>"),this.$el.append(this.navView.render().el),this}})}),define("ekai/app-store/1.0.0/views/nav",["backbone","underscore","store","topivi","iscroll","ekai/app-store/1.0.0/collections/category","ekai/app-store/1.0.0/models/category","ekai/app-store/1.0.0/settings.json","ekai/app-store/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("store"),g=a("topivi"),h=a("iscroll"),i=a("ekai/app-store/1.0.0/templates/nav.tpl"),j=a("ekai/app-store/1.0.0/collections/category"),k=a("ekai/app-store/1.0.0/settings.json"),l=k.STORAGE_KEYS,m=f.get(l.categories);m=m||[],c.exports=d.View.extend({id:"category-list-wrapper",className:"nav",template:e.template(i),events:{"tap .item":"navItemClick"},constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.currentCategory="all",this.collection=new j(m)},render:function(){return this.collection.length<=0?this.fetchCategories(this.renderCategories):this.renderCategories(),this},fetchCategories:function(a){var b=this;this.collection.fetch({timeout:5e3,success:function(c){f.set(l.categories,c.toJSON()),a.apply(b,arguments)},error:function(){new g.dialog.normal("",{removeAfterClose:!0,content:"获取分类失败，请稍后再试..."}).open()}})},renderCategories:function(){this.$el.empty(),this.$el.html(this.template({categories:this.collection,current:this.currentCategory})),this.$el.wrapInner("<ul id='category-list'></ul>"),setTimeout(function(){self.scroll=new h("#category-list-wrapper")},100)},navItemClick:function(a){var b=d.$(a.currentTarget),c=b.attr("data-key");this.currentCategory=c,this.$el.find("li.active").removeClass("active"),b.addClass("active"),this.trigger("changeCategory",c)}})}),define("ekai/app-store/1.0.0/templates/nav.tpl",[],"<li data-key=\"all\" class=\"item {{=(current === 'all') ? 'active' : ''}}\">全部</li>\n{{\n    categories.each(function (category) {\n}}\n<li data-key=\"{{=category.id}}\" class=\"item {{=(current === category.id) ? 'active' : ''}}\">{{=category.get('name')}}</li>\n{{\n    });\n}}"),define("ekai/app-store/1.0.0/collections/category",["backbone","ekai/app-store/1.0.0/models/category","ekai/app-store/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("ekai/app-store/1.0.0/models/category"),f=a("ekai/app-store/1.0.0/settings.json");c.exports=d.Collection.extend({model:e,url:function(){return f.API_URL+"/app-category/list?app_key="+f.APP_KEY},parse:function(a){return a.categories}})}),define("ekai/app-store/1.0.0/models/category",["backbone"],function(a,b,c){var d=a("backbone");c.exports=d.Model.extend({idAttribute:"_id",defaults:{count:0}})}),define("ekai/app-store/1.0.0/settings.json",[],{API_URL:"http://www.topivi.com:3001/api",APP_KEY:"d7c7ce69d618446d6a84081d62682018",STORAGE_KEYS:{categories:"app-store_categories",apps:"app-store_apps",home_apps:"home_apps"},enabled_apps:["DLNA","APP Link","Driving Habits Analysis","Drive Magazine","Maintenance"]}),define("ekai/app-store/1.0.0/views/main",["backbone","ekai/app-store/1.0.0/views/content","underscore","store","topivi","iscroll","ekai/app-store/1.0.0/collections/app","ekai/app-store/1.0.0/models/app","ekai/app-store/1.0.0/settings.json","ekai/app-store/1.0.0/views/app-item","ekai/app-store/1.0.0/views/app-detail"],function(a,b,c){var d=a("backbone"),e=a("ekai/app-store/1.0.0/views/content");c.exports=d.View.extend({className:"main",constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.contentView=new e},render:function(){return this.$el.empty(),this.$el.append(this.contentView.render().el),this},changePage:function(a){this.contentView.changePage(a)}})}),define("ekai/app-store/1.0.0/views/content",["backbone","underscore","store","topivi","iscroll","ekai/app-store/1.0.0/collections/app","ekai/app-store/1.0.0/models/app","ekai/app-store/1.0.0/settings.json","ekai/app-store/1.0.0/views/app-item","ekai/app-store/1.0.0/views/app-detail","ekai/app-store/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("store"),g=a("topivi"),h=a("iscroll"),i=a("ekai/app-store/1.0.0/templates/content.tpl"),j=a("ekai/app-store/1.0.0/collections/app"),k=a("ekai/app-store/1.0.0/views/app-item"),l=a("ekai/app-store/1.0.0/settings.json"),m=l.STORAGE_KEYS,n=f.get(m.apps);n=n||[],c.exports=d.View.extend({id:"app-store-content",className:"content",template:e.template(i),constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.currentCategory="all",this.collection=new j(n)},render:function(){return this.collection.length<=0?this.fetchApps(this.renderApps):this.renderApps(),this},fetchApps:function(a){var b=this;this.collection.fetch({timeout:5e3,success:function(c){f.set(m.apps,c.toJSON()),a.apply(b,arguments)},error:function(){new g.dialog.normal("",{removeAfterClose:!0,content:"获取应用列表失败，请稍后再试..."}).open()}})},renderApps:function(){var a=this;this.$el.empty(),this.$el.html(this.template({}));var b=this.$el.find("#app-list"),c=null;c="all"===this.currentCategory?this.collection.models:this.collection.where({category:this.currentCategory}),c.length<=0?b.append("<li class='info'>该分类下没有应用</li>"):(e.each(c,function(a){var c=new k({model:a});b.append(c.render().el)}),setTimeout(function(){a.scroll=new h("#app-store-content")},100))},changeCategory:function(a){this.currentCategory=a,this.renderApps()}})}),define("ekai/app-store/1.0.0/templates/content.tpl",[],'<ul id="app-list" class="listview"></ul>'),define("ekai/app-store/1.0.0/collections/app",["backbone","ekai/app-store/1.0.0/models/app","underscore","store","topivi","ekai/app-store/1.0.0/settings.json","ekai/app-store/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("ekai/app-store/1.0.0/models/app"),f=a("ekai/app-store/1.0.0/settings.json");c.exports=d.Collection.extend({model:e,url:function(){return f.API_URL+"/app/unauth-list?app_key="+f.APP_KEY},parse:function(a){return a.apps}})}),define("ekai/app-store/1.0.0/models/app",["backbone","underscore","store","topivi","ekai/app-store/1.0.0/settings.json"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("store"),g=a("topivi"),h=a("ekai/app-store/1.0.0/settings.json"),i=h.STORAGE_KEYS,j=f.get(i.home_apps);j=j||[];var k=h.enabled_apps;c.exports=d.Model.extend({idAttribute:"_id",defaults:{charge:0,rating:"4",previews:[],installed:!1,install_status:"none",is_enabled:!1},initialize:function(){this.initSizeName(),this.checkInstalled(),this.checkEnabled()},checkInstalled:function(){var a=this.get("name");return e.findWhere(j,{name:a})&&this.set("installed",!0),this.get("installed")},initSizeName:function(){var a=this.get("size");this.set("size_name",g.util.fileSizeString(a,1))},checkEnabled:function(){var a=this.get("name");e.contains(k,a)&&this.set("is_enabled",!0)}})}),define("ekai/app-store/1.0.0/views/app-item",["backbone","underscore","store","topivi","ekai/app-store/1.0.0/views/app-detail","iscroll","ekai/app-store/1.0.0/settings.json"],function(a,b,c){var d=parent.seajs.require("jquery"),e=a("backbone"),f=a("underscore"),g=a("store"),h=a("topivi"),i=a("ekai/app-store/1.0.0/templates/app-item.tpl"),j=a("ekai/app-store/1.0.0/views/app-detail"),k=a("ekai/app-store/1.0.0/settings.json"),l=k.STORAGE_KEYS;c.exports=e.View.extend({tagName:"li",className:"item",template:f.template(i),events:{"tap .install":"installBtnClick","tap .uninstall":"uninstallBtnClick","tap .link":"showDetailDialog","tap .pause":"pauseDownloadBtnClick","tap .stop":"stopDownloadBtnClick"},constructor:function(){e.View.apply(this,arguments)},initialize:function(){this.listenTo(this.model,"change:installed",this.installedStatusChanged),this.listenTo(this.model,"change",this.updateStoreApp)},render:function(){return this.$el.empty(),this.$el.html(this.template(this.model.attributes)),this},updateStoreApp:function(a){for(var b=g.get(l.apps),c=0;c<b.length;c++)if(a.id===b[c]._id){b[c]=a.toJSON();break}g.set(l.apps,b)},installedStatusChanged:function(a,b){var c=this.$el.find(".install");if(b)c.text("打开"),this.$el.prepend("<div class='uninstall'></div>");else{var d=a.get("charge");c.text(d>0?"￥"+d:"免费"),this.$el.find(".uninstall").remove()}},installBtnClick:function(a){a.stopPropagation();var b=this,c=e.$(a.currentTarget);if(!c.hasClass("installing")&&!c.hasClass("disabled")){var d=this.$el.find(".loading"),f=this.$el.find(".btns"),g=this.$el.find(".download-progress"),i=this.model.get("installed");if(i)return console.log("Open app -> "+this.model.get("name")),this.noticeHomeOpenApp();var j=function(){d.hide(),f.show(),g.show(),b.startDownload()},k=function(){d.hide(),c.show()};c.hide();var l=this.model.get("charge");if(l>0){var m=new h.dialog.confirm("",{useMask:!0,closeGesture:"clickmask",removeAfterClose:!0,content:"下载该应用需要收费，金额：￥"+l,onOkClick:function(){d.show(),c.addClass("installing"),b.checkDownload({success:j,error:k})},onClose:function(a){a=a||{},a.from&&"ok"!==a.from&&c.show()}});m.el.addClass("app-store"),m.open()}else d.show(),c.addClass("installing"),this.checkDownload({success:j,error:k})}},uninstallBtnClick:function(a){var b=this;a.stopPropagation();var c=this.model.get("installed");c&&d(parent.document).trigger("uninstallApp",{app:{id:this.model.id},callback:function(){b.model.set("installed",!1)}})},checkDownload:function(a){setTimeout(a.success,1e3)},startDownload:function(){var a=this,b=this.$el.find(".download-progress");this.downloadProgress=new h.progress.line(b,{onEnd:function(){clearInterval(a.downloadInterval),a.startInstall()}}),this.createDownloadRunnable()},pauseDownloadBtnClick:function(a){a.stopPropagation();var b=e.$(a.currentTarget);b.hasClass("paused")?this.createDownloadRunnable():this.downloadInterval&&clearInterval(this.downloadInterval),b.toggleClass("paused")},createDownloadRunnable:function(){var a=this;this.downloadInterval=setInterval(function(){var b=40*Math.random();a.downloadProgress.plusProgress(b)},1e3)},stopDownloadBtnClick:function(a){a.stopPropagation();var b=this.$el.find(".install"),c=this.$el.find(".btns"),d=this.$el.find(".download-progress"),e=this.$el.find(".pause");this.downloadInterval&&clearInterval(this.downloadInterval),this.downloadProgress=void 0,c.hide(),d.hide(),b.show(),b.removeClass("installing"),e.removeClass("paused")},startInstall:function(){var a=this,b=this.$el.find(".install"),c=this.$el.find(".btns"),d=this.$el.find(".download-progress");b.text("安装中..."),b.show(),c.hide(),d.hide(),this.noticeHomeInstallApp(function(){a.model.set("installed",!0),b.removeClass("installing")})},noticeHomeInstallApp:function(a){d(parent.document).trigger("installApp",{callback:a,app:{_id:this.model.id,name:this.model.get("name")}})},noticeHomeOpenApp:function(){var a=this.model.get("name");d(parent.document).trigger("openApp",a)},showDetailDialog:function(a){var b,c,d=e.$(a.currentTarget),f=d.offset(),g=d.width(),i=d.height(),k=new j({model:this.model}),l=new h.dialog.normal("#app-detail-dialog",{useMask:!0,closeGesture:"clickmask",content:k.render().el,beforeOpen:function(){d.hide()},onOpen:function(){k.initScrolls()},onClose:function(){d.show(),k.remove()},inAnimation:function(a){var d=200,e="easeOutBack";this.el.animate({top:"50%",left:"50%",width:b,height:c,marginTop:-c/2,marginLeft:-b/2},d,e,function(){a()})},outAnimation:function(a){var d=this,e=200,h="easeInBack";this.el.animate({top:f.top,left:f.left,width:g,height:i,marginTop:"0",marginLeft:"0"},e,h,function(){d.el.css({width:b,height:c,"margin-top":0,"margin-left":0}),a()})}});b=l.el.width(),c=l.el.height(),l.el.css({width:d.width(),height:d.height(),top:f.top,left:f.left,"margin-top":0,"margin-left":0}),l.open()}})}),define("ekai/app-store/1.0.0/templates/app-item.tpl",[],'{{\nif (installed) {\n}}\n<div class="uninstall"></div>\n{{\n}\n}}\n<a class="link">\n    <div class="download-progress"></div>\n    <div class="left">\n        <img alt="{{=name}}" class="thumbnail" src="{{=thumbnail}}"/>\n        <ul class="rating stars">\n          {{\n            for (var i = 0; i < rating; i++) {\n          }}\n            <li class="star active"></li>\n          {{\n            }\n          }}\n            {{\n            for (var i = rating; i < 5; i++) {\n            }}\n            <li class="star"></li>\n            {{\n            }\n            }}\n        </ul>\n    </div>\n    <div class="right">\n        <h1 class="name">{{=name}}</h1>\n        <p class="version-number">版本：<span class="value">{{=version_number}}</span></p>\n        <p class="size">大小：<span class="value">{{=size_name}}</span></p>\n        <div class="install {{=!is_enabled ? \'disabled\' : \'\'}}">{{=installed ? \'打开\' : (charge > 0 ? \'￥\' + charge : \'免费\')}}</div>\n        <div class="btns">\n            <div class="small-btn pause"></div>\n            <div class="small-btn stop"></div>\n        </div>\n        <div class="loading"></div>\n    </div>\n</a>'),define("ekai/app-store/1.0.0/views/app-detail",["backbone","underscore","topivi","iscroll"],function(a,b,c){var d=parent.seajs.require("jquery"),e=a("backbone"),f=a("underscore"),g=a("topivi"),h=a("iscroll"),i=a("ekai/app-store/1.0.0/templates/app-detail.tpl");c.exports=e.View.extend({className:"scroller",template:f.template(i),events:{"tap .install":"installBtnClick","tap .pause":"pauseDownloadBtnClick","tap .stop":"stopDownloadBtnClick"},constructor:function(){e.View.apply(this,arguments)},initialize:function(){this.listenTo(this.model,"change:installed",this.installedStatusChanged)},render:function(){return this.$el.empty(),this.$el.html(this.template(this.model.attributes)),this},installedStatusChanged:function(a,b){var c=this.$el.find(".install");if(b)c.text("打开");else{var d=a.get("charge");c.text(d>0?"￥"+d:"免费")}},initScrolls:function(){var a=this;setTimeout(function(){a.contentScroll=new h("#app-detail-dialog .content");var b=a.$el.find(".wrapper>ul");b.length>0&&(a.resetPreviewWidth(),a.previewsScroll=new h("#app-detail-dialog .wrapper",{scrollX:!0,scrollY:!1,click:!0}))},100)},resetPreviewWidth:function(){var a=this.$el.find(".wrapper ul"),b=this.model.get("previews").length,c=a.find(".item").outerWidth(!0);a.css("width",b*c)},installBtnClick:function(a){a.stopPropagation();var b=this,c=e.$(a.currentTarget);if(!c.hasClass("installing")&&!c.hasClass("disabled")){var d=this.$el.find(".loading"),f=this.$el.find(".btns"),h=this.$el.find(".download-progress"),i=this.model.get("installed");if(i)return console.log("Open app -> "+this.model.get("name")),this.noticeHomeOpenApp();var j=function(){d.hide(),f.show(),h.show(),b.startDownload()},k=function(){d.hide(),c.show()};c.hide();var l=this.model.get("charge");if(l>0){var m=new g.dialog.confirm("",{useMask:!0,closeGesture:"clickmask",removeAfterClose:!0,content:"下载该应用需要收费，金额：￥"+l,onOkClick:function(){d.show(),c.addClass("installing"),b.checkDownload({success:j,error:k})},onClose:function(a){a=a||{},a.from&&"ok"!==a.from&&c.show()}});m.el.addClass("app-store"),m.open()}else d.show(),c.addClass("installing"),this.checkDownload({success:j,error:k})}},checkDownload:function(a){setTimeout(a.success,1e3)},startDownload:function(){var a=this,b=this.$el.find(".download-progress");this.downloadProgress=new g.progress.line(b,{onEnd:function(){clearInterval(a.downloadInterval),a.startInstall()}}),this.createDownloadRunnable()},pauseDownloadBtnClick:function(a){a.stopPropagation();var b=e.$(a.currentTarget);b.hasClass("paused")?this.createDownloadRunnable():this.downloadInterval&&clearInterval(this.downloadInterval),b.toggleClass("paused")},createDownloadRunnable:function(){var a=this;this.downloadInterval=setInterval(function(){var b=40*Math.random();a.downloadProgress.plusProgress(b)},1e3)},stopDownloadBtnClick:function(a){a.stopPropagation();var b=this.$el.find(".install"),c=this.$el.find(".btns"),d=this.$el.find(".download-progress"),e=this.$el.find(".pause");this.downloadInterval&&clearInterval(this.downloadInterval),this.downloadProgress=void 0,c.hide(),d.hide(),b.show(),b.removeClass("installing"),e.removeClass("paused")},startInstall:function(){var a=this,b=this.$el.find(".install"),c=this.$el.find(".btns"),d=this.$el.find(".download-progress");b.text("安装中..."),b.show(),c.hide(),d.hide(),this.noticeHomeInstallApp(function(){a.model.set("installed",!0),b.removeClass("installing")})},noticeHomeInstallApp:function(a){d(parent.document).trigger("installApp",{callback:a,app:{_id:this.model.id,name:this.model.get("name")}})},noticeHomeOpenApp:function(){var a=this.model.get("name");d(parent.document).trigger("openApp",a)}})}),define("ekai/app-store/1.0.0/templates/app-detail.tpl",[],'<div class="basic-info part">\n    <div class="left"><img alt="{{=name}}" class="thumbnail" src="{{=thumbnail}}"/></div>\n    <div class="right">\n        <h1 class="name">{{=name}}</h1>\n        <p class="developer">{{=developer}}</p>\n        <ul class="rating stars">\n            {{\n            for (var i = 0; i < rating; i++) {\n            }}\n            <li class="star active"></li>\n            {{\n            }\n            }}\n            {{\n            for (var i = rating; i < 5; i++) {\n            }}\n            <li class="star"></li>\n            {{\n            }\n            }}\n        </ul>\n        <div class="install {{=!is_enabled ? \'disabled\' : \'\'}}">{{=installed ? \'打开\' : (charge > 0 ? \'￥\' + charge : \'免费\')}}</div>\n        <div class="loading"></div>\n        <div class="btns">\n            <div class="download-progress"></div>\n            <div class="small-btn pause"></div>\n            <div class="small-btn stop"></div>\n        </div>\n    </div>\n</div>\n<div class="previews part">\n    {{\n    if (previews.length <= 0) {\n    }}\n        <p class="info">没有预览图</p>\n    {{\n        } else {\n    }}\n    <div class="wrapper">\n        <ul>\n    {{\n            for (var i = 0; i < previews.length; i++) {\n    }}\n            <li class="item"><img alt="预览图{{=i}}" class="preview" src="{{=previews[i]}}"/></li>\n    {{\n            }\n    }}\n        </ul>\n    </div>\n    {{\n        }\n    }}\n</div>\n<div class="description part">\n    <h2 class="title">内容提要</h2>\n    <p class="text">{{=description}}</p>\n</div>\n<div class="new-feature part">\n    <h2 class="title">新功能</h2>\n    <p class="text">{{=change_log}}</p>\n</div>');
