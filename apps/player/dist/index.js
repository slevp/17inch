define("ekai/player/1.0.0/main",["backbone","ekai/player/1.0.0/routers/index","ekai/player/1.0.0/views/mode-normal","underscore","topivi","ekai/player/1.0.0/collections/song","ekai/player/1.0.0/models/song","ekai/player/1.0.0/views/song-list","ekai/player/1.0.0/views/song-list-item","iscroll","ekai/player/1.0.0/views/mode-footer","ekai/player/1.0.0/models/player","store","ekai/player/1.0.0/settings.json","ekai/player/1.0.0/data/songs.json"],function(a){var b=a("backbone"),c=a("ekai/player/1.0.0/routers/index");new c,b.history.start()}),define("ekai/player/1.0.0/routers/index",["backbone","ekai/player/1.0.0/views/mode-normal","underscore","topivi","ekai/player/1.0.0/collections/song","ekai/player/1.0.0/models/song","ekai/player/1.0.0/views/song-list","ekai/player/1.0.0/views/song-list-item","iscroll","ekai/player/1.0.0/views/mode-footer","ekai/player/1.0.0/models/player","store","ekai/player/1.0.0/settings.json","ekai/player/1.0.0/data/songs.json"],function(a,b,c){var d=parent.seajs.require("jquery"),e=a("backbone"),f=a("ekai/player/1.0.0/views/mode-normal"),g=a("ekai/player/1.0.0/views/mode-footer"),h=a("ekai/player/1.0.0/models/player"),i=new h,j=null;d(parent.document).on("getPlayerSongList",function(a,b){b(i.list)}),c.exports=e.Router.extend({routes:{"":"homePage","$mode/:mode":"modePage"},homePage:function(){j&&j.remove(),j=new f({player:i}),e.$("body").prepend(j.render().el)},modePage:function(a){switch(a=a||"footer"){case"middle":j&&j.remove(),j=new f({player:i}),e.$("body").prepend(j.render().el);break;case"footer":j&&j.remove(),j=new g({player:i,expanded:!1}),e.$("body").prepend(j.render().el);break;case"footer-expanded":j&&j.remove(),j=new g({player:i,expanded:!0}),e.$("body").prepend(j.render().el)}}})}),define("ekai/player/1.0.0/views/mode-normal",["backbone","underscore","topivi","ekai/player/1.0.0/collections/song","ekai/player/1.0.0/models/song","ekai/player/1.0.0/views/song-list","ekai/player/1.0.0/views/song-list-item","iscroll"],function(a,b,c){function d(){f.View.apply(this,arguments)}var e=parent.seajs.require("jquery"),f=a("backbone"),g=a("underscore"),h=a("topivi"),i=a("ekai/player/1.0.0/templates/mode-normal.tpl"),j=a("ekai/player/1.0.0/templates/mode-normal-content.tpl"),k=a("ekai/player/1.0.0/collections/song"),l=a("ekai/player/1.0.0/views/song-list");c.exports=f.View.extend({className:"page",template:g.template(i),contentTemplate:g.template(j),events:{"tap .play-btn":"playBtnClick","tap .previous":"previousBtnClick","tap .next":"nextBtnClick","swiperight .content":"previousBtnClick","swipeleft .content":"nextBtnClick","tap .show-list-btn":"showListBtnClick"},constructor:d,initialize:function(a){var b=this;this.player=a.player,this.player.onEnd=function(){b.cutSongOutAnimation(function(){this.render(),this.cutSongInAnimation()})},this.collection=new k(this.player.list),this.$el.attr("data-mode","normal"),e(parent.document).on("playSong",function(a,c){var d=b.collection.findWhere({title:c}).id;b.cutToSong(d),b.player.isPlaying||b.$el.find(".play-btn").trigger("tap")}),e(parent.document).on("randomPlaySong",function(){var a=parseInt(Math.random()*b.collection.length);b.cutToSong(b.collection.at(a).id),b.player.isPlaying||b.$el.find(".play-btn").trigger("tap")})},render:function(){var a=this;return this.$el.empty(),this.$el.html(this.template()),this.renderContent(),this.$el.find(".volume-progress .dot").drag({axis:"x",ondrag:function(){var b=f.$(this),c=b.width(),d=a.$el.find(".volume-progress .bg"),e=a.$el.find(".volume-progress .running"),g=d.width(),h=d.offset().left-c/2,i=d.offset().left+g+c/2;if(b.offset().left>i)b.css("left","100%"),e.css("width","100%");else if(b.offset().left<h)b.css("left","0"),e.css("width","0");else{var j=b.css("left");j=parseFloat(j.substr(0,j.length-2)),e.css("width",100*(j/g)+"%")}}}),this.player.isPlaying&&this.createPlayRunnable(),this},renderContent:function(){var a=this.$el.find(".content"),b=this.collection.at(this.player.current);a.html(this.contentTemplate({isPlaying:this.player.isPlaying,current:b.attributes,previous:this.collection.at(this.player.previous).attributes,next:this.collection.at(this.player.next).attributes})),this.$el.find(".header .title .name").text(b.get("title")),this.$el.find(".header .title .artists .value").text(b.get("artists")),this.$el.find(".footer .lyric-sound .lyric").text(b.get("lyrics")[0]),this.playProgress=new h.progress.round(this.$el.find(".playing-progress"),{max:1e3}),this.songListView&&this.songListView.activeItem(b.id)},playBtnClick:function(a){var b=f.$(a.currentTarget);this.player.isPlaying?(this.player.pause(),b.removeClass("playing"),this.interval&&clearInterval(this.interval)):(this.player.play(),b.addClass("playing"),this.createPlayRunnable())},createPlayRunnable:function(){var a=this,b=function(){var b=a.$el.find(".current .duration"),c=a.player.getDurationText();b.text("-"+c);var d=parseInt(1e3*(a.player.audio.currentTime/a.player.audio.duration));g.isNaN(d)&&(d=0),a.playProgress.setProgress(d)};this.interval&&clearInterval(this.interval),this.interval=setInterval(b,1e3)},nextBtnClick:function(){this.cutSongOutAnimation(function(){this.player.nextSong(),this.renderContent(),this.cutSongInAnimation()})},previousBtnClick:function(){this.cutSongOutAnimation(function(){this.player.previousSong(),this.renderContent(),this.cutSongInAnimation()})},cutToSong:function(a){var b=this.collection.get(a),c=this.collection.indexOf(b);this.cutSongOutAnimation(function(){this.player.playSong(c),this.renderContent(),this.cutSongInAnimation()})},cutSongOutAnimation:function(a){var b=this,c=100;this.$el.find(".content").fadeOut(c,function(){a&&a.call(b)})},cutSongInAnimation:function(a){var b=this,c=200;this.$el.find(".content").fadeIn(c,function(){a&&a.call(b)})},remove:function(){this.interval&&clearInterval(this.interval),d.__super__.remove.call(this)},showListBtnClick:function(a){var b=f.$(a.currentTarget);this.listTips||(this.listTips=new h.tips.normal("",{dependEl:b,direction:"right"}),this.listTips.el.addClass("song-list-tips")),this.songListView||(this.songListView=new l({player:this.player,collection:this.collection,mainView:this})),b.hasClass("active")?this.listTips.hide():(this.listTips.setContent(this.songListView.render().el),this.listTips.show()),b.toggleClass("active")}})}),define("ekai/player/1.0.0/templates/mode-normal.tpl",[],'<div class="header">\n    <div class="show-list-btn"></div>\n    <div class="title">\n        <h1 class="name"></h1>\n        <p class="artists">艺人：<span class="value"></span></p>\n    </div>\n    <div class="play-mode">\n        <div class="normal mode-btn active"></div>\n        <div class="mv mode-btn"></div>\n    </div>\n</div>\n<div class="content">\n\n</div>\n<div class="footer">\n    <div class="alternate"></div>\n    <div class="lyric-sound">\n        <p class="lyric"></p>\n        <div class="sound">\n           <div class="min"></div>\n            <div class="volume-progress">\n                <div class="bg"></div>\n                <div class="running"></div>\n                <div class="dot"></div>\n            </div>\n            <div class="max"></div>\n        </div>\n    </div>\n    <div class="repeat"></div>\n</div>'),define("ekai/player/1.0.0/templates/mode-normal-content.tpl",[],'<div class="previous block">\n    <img class="thumbnail circle" src="{{=previous.thumbnail}}"/>\n    <div class="bg circle"></div>\n    <p class="name">{{=previous.title}}</p>\n    <p class="artists">艺人：{{=previous.artists}}</p>\n    <p class="duration">-{{=previous.duration}}</p>\n</div>\n<div class="current block">\n    <div class="playing-progress"></div>\n    <img class="thumbnail circle" src="{{=current.thumbnail}}"/>\n    <div class="bg circle"></div>\n    <div class="play-btn {{=isPlaying ? \'playing\' : \'\'}}"></div>\n    <p class="duration">-{{=current.duration}}</p>\n</div>\n<div class="next block">\n    <img class="thumbnail circle" src="{{=next.thumbnail}}"/>\n    <div class="bg circle"></div>\n    <p class="name">{{=next.title}}</p>\n    <p class="artists">艺人：{{=next.artists}}</p>\n    <p class="duration">-{{=next.duration}}</p>\n</div>'),define("ekai/player/1.0.0/collections/song",["backbone","ekai/player/1.0.0/models/song"],function(a,b,c){var d=a("backbone"),e=a("ekai/player/1.0.0/models/song");c.exports=d.Collection.extend({model:e})}),define("ekai/player/1.0.0/models/song",["backbone"],function(a,b,c){var d=a("backbone");c.exports=d.Model.extend({idAttribute:"_id"})}),define("ekai/player/1.0.0/views/song-list",["backbone","underscore","ekai/player/1.0.0/views/song-list-item","iscroll"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("ekai/player/1.0.0/templates/song-list.tpl"),g=a("ekai/player/1.0.0/views/song-list-item"),h=a("iscroll");c.exports=d.View.extend({template:e.template(f),events:{"tap .item":"itemClickEvent"},constructor:function(){d.View.apply(this,arguments)},initialize:function(a){this.player=a.player,this.mainView=a.mainView},render:function(){var a=this;this.delegateEvents(),this.$el.empty(),this.$el.html(this.template({}));var b=this.collection.at(this.player.current),c=this.$el.find(".listview ul"),d=null;return e.each(this.collection.models,function(a){var e=new g({model:a});e.render(),b.id===a.id&&(d=e.el,e.$el.addClass("current")),c.append(e.el)}),setTimeout(function(){a.scroll=new h(".listview"),a.scroll.scrollToElement(d,1e3)},200),this},itemClickEvent:function(a){var b=d.$(a.currentTarget);if(!b.hasClass("current")){var c=b.attr("data-id");this.mainView.cutToSong(c)}},activeItem:function(a){var b=this.$el.find(".item[data-id='"+a+"']");return!b||b.length<=0?console.error("Not found song by id."):(b.hasClass("current")||(this.$el.find(".item.current").removeClass("current"),b.addClass("current"),this.scroll.scrollToElement(b[0],1e3)),void 0)}})}),define("ekai/player/1.0.0/templates/song-list.tpl",[],'<div id="song-list" class="content">\n    <h1 class="title">播放列表</h1>\n    <div class="listview">\n        <ul class="scroller"></ul>\n    </div>\n</div>\n<div class="angle"></div>'),define("ekai/player/1.0.0/views/song-list-item",["backbone","underscore"],function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("ekai/player/1.0.0/templates/song-list-item.tpl");c.exports=d.View.extend({tagName:"li",className:"item",template:e.template(f),constructor:function(){d.View.apply(this,arguments)},initialize:function(){this.$el.attr("data-id",this.model.id)},render:function(){return this.$el.html(this.template(this.model.attributes)),this}})}),define("ekai/player/1.0.0/templates/song-list-item.tpl",[],'<p class="name">{{=title}}</p>\n<p class="artists-duration">\n    <span class="artists">{{=artists}}</span>\n    <span class="duration">{{=duration}}</span>\n</p>\n'),define("ekai/player/1.0.0/views/mode-footer",["backbone","underscore","topivi","ekai/player/1.0.0/collections/song","ekai/player/1.0.0/models/song"],function(a,b,c){function d(){e.View.apply(this,arguments)}var e=a("backbone"),f=a("underscore"),g=a("topivi"),h=a("ekai/player/1.0.0/templates/mode-footer.tpl"),i=a("ekai/player/1.0.0/collections/song");c.exports=e.View.extend({className:"page",template:f.template(h),events:{"tap .play-btn":"playBtnClick","tap .previous":"previousBtnClick","tap .next":"nextBtnClick","swiperight .content":"previousBtnClick","swipeleft .content":"nextBtnClick"},constructor:d,initialize:function(a){var b=this;this.player=a.player,this.player.onEnd=function(){b.render()},this.collection=new i(this.player.list),this.$el.attr("data-mode","footer"),this.isExpaneded=a.expanded,this.isExpaneded&&this.$el.addClass("expanded")},render:function(){return this.$el.empty(),this.$el.html(this.template({isPlaying:this.player.isPlaying,current:this.collection.at(this.player.current).attributes})),this.playProgress=new g.progress.round(this.$el.find(".playing-progress"),{max:1e3}),this.player.isPlaying&&this.createPlayRunnable(),this},playBtnClick:function(a){var b=e.$(a.currentTarget);this.player.isPlaying?(this.player.pause(),b.removeClass("playing"),this.interval&&clearInterval(this.interval)):(this.player.play(),b.addClass("playing"),this.createPlayRunnable())},createPlayRunnable:function(){var a=this,b=function(){var b=a.$el.find(".current .duration"),c=a.player.getDurationText();b.text("-"+c);var d=parseInt(1e3*(a.player.audio.currentTime/a.player.audio.duration));f.isNaN(d)&&(d=0),a.playProgress.setProgress(d)};this.interval&&clearInterval(this.interval),this.interval=setInterval(b,1e3)},nextBtnClick:function(){this.player.nextSong(),this.render()},previousBtnClick:function(){this.player.previousSong(),this.render()},remove:function(){this.interval&&clearInterval(this.interval),d.__super__.remove.call(this)}})}),define("ekai/player/1.0.0/templates/mode-footer.tpl",[],'<div class="left">\n    <div class="header"><h1 class="title">AUDIO</h1></div>\n    <div class="content">\n        <div class="previous"></div>\n        <div class="current">\n            <div class="playing-progress"></div>\n            <div class="play-btn {{=isPlaying ? \'playing\' : \'\'}}"></div>\n            <p class="duration">-{{=current.duration}}</p>\n        </div>\n        <div class="next"></div>\n    </div>\n    <div class="footer">\n        <div class="volume"></div>\n        <p class="name">{{=current.title}}</p>\n        <div class="repeat"></div>\n    </div>\n</div>\n<div class="right">\n    <p class="name">{{=current.title}}</p>\n    <p class="artists">{{=current.artists}}</p>\n    <p class="lyrics-desc">歌词内容</p>\n    <div class="lyrics">\n        <div class="scroll">\n        {{\n            for (var i = 0; i < current.lyrics.length; i++) {\n        }}\n            <p class="line">{{=current.lyrics[i]}}</p>\n        {{\n            }\n        }}\n        </div>\n    </div>\n</div>'),define("ekai/player/1.0.0/models/player",["underscore","store","ekai/player/1.0.0/settings.json","ekai/player/1.0.0/data/songs.json"],function(a,b,c){function d(a){a=a||{};var b={isPlaying:!1,current:j,list:i,onEnd:function(){console.log("song on auto complete.")}};e.extend(this,b,a),this.init()}var e=a("underscore"),f=a("store"),g=a("ekai/player/1.0.0/settings.json"),h=g.STORAGE_KEYS,i=f.get(h.songs),j=f.get(h.last_played);j=j||0,i||(i=a("ekai/player/1.0.0/data/songs.json"),f.set(h.songs,i)),d.prototype.init=function(){var a=this;return this.list=this.list||[],this.list.length<=0?console.info("No songs"):(this.audio=document.createElement("audio"),this.list[this.current]||(console.error("Invalid current param."),this.current=0),this.audio.src=this.list[this.current].contentURI,this.audio.addEventListener("ended",function(){a.nextSong(),a.onEnd.apply(a,arguments)}),this.previous=this.getPrevious(),this.next=this.getNext(),void 0)},d.prototype.getPrevious=function(){return this.current<=0?this.list.length-1>0?this.list.length-1:0:this.current-1},d.prototype.getNext=function(){return this.current<this.list.length-1?this.current+1:0},d.prototype.play=function(){this.isPlaying||(this.isPlaying=!0),this.audio.play()},d.prototype.pause=function(){this.isPlaying&&(this.isPlaying=!1),this.audio.pause()},d.prototype.stop=function(){},d.prototype.nextSong=function(){this.previous=this.current,this.current=this.next,this.next=this.getNext(),this.audio.src=this.list[this.current].contentURI,this.isPlaying&&this.play(),f.set(h.last_played,this.current)},d.prototype.previousSong=function(){this.next=this.current,this.current=this.previous,this.previous=this.getPrevious(),this.audio.src=this.list[this.current].contentURI,this.isPlaying&&this.play(),f.set(h.last_played,this.current)},d.prototype.playSong=function(a){return 0>a||a>this.list.length?console.error("Invalid song index."):(this.current=a,this.next=this.getNext(),this.previous=this.getPrevious(),this.audio.src=this.list[this.current].contentURI,this.isPlaying&&this.play(),f.set(h.last_played,this.current),void 0)},d.prototype.getRemainingTime=function(){var a=Math.ceil(this.audio.currentTime),b=Math.ceil(this.audio.duration);return b-a},d.prototype.getDurationText=function(){var a=this.getRemainingTime(),b=parseInt(a/60),c=a%60;return c=c>9?c+"":"0"+c,b+":"+c},c.exports=d}),define("ekai/player/1.0.0/settings.json",[],{STORAGE_KEYS:{songs:"player_songs",last_played:"player_last_played_index"}}),define("ekai/player/1.0.0/data/songs.json",[],[{_id:1,title:"空白格",artists:"杨宗纬",contentURI:"mp3/kongbaige.mp3",thumbnail:"mp3/thumbnails/yangzongwei.jpg",duration:"4:48",album:"我是歌手 第五期",lyrics:["其实很简单","其实很自然","两个人的爱由两人分担","其实并不难","是你太悲观","隔着一道墙不跟谁分享"]},{_id:2,title:"父亲",artists:"筷子兄弟",contentURI:"mp3/fuqin.mp3",thumbnail:"mp3/thumbnails/kuaizixiongdi.jpg",duration:"4:53",album:"父亲",lyrics:["总是向你索取","却不曾说谢谢你","直到长大以后","才懂得你不容易","每次离开总是","装作轻松的样子","微笑着说回去吧","转身泪湿眼底"]},{_id:3,title:"你是我的眼",artists:"林宥嘉",contentURI:"mp3/nishiwodeyan.mp3",thumbnail:"mp3/thumbnails/linyoujia.jpg",duration:"4:45",album:"爱星光精选 昨天今天明天",lyrics:["如果我能看得见","就能清晰地分辨白天黑夜","就能准确地在人群中握住你的手","如果我能看得见","就能驾车带你到处遨游","就能惊喜地从背后给你一个拥抱"]},{_id:4,title:"最爱",artists:"杨宗纬",contentURI:"mp3/zuiai.mp3",thumbnail:"mp3/thumbnails/yangzongwei.jpg",duration:"5:32",album:"我是歌手 第十二期",lyrics:["红颜若是只为一段情","就让一生只为这段情","一生只爱一个人","一世只怀一种愁","纤纤小手让你握着","把它握成你的袖","纤纤小手让你握着","解你的愁你的忧"]},{_id:5,title:"其实都没有",artists:"杨宗纬",contentURI:"mp3/qishidoumeiyou.mp3",thumbnail:"mp3/thumbnails/yangzongwei.jpg",duration:"3:51",album:"初.爱",lyrics:["从什么都没有的地方","到什么都没有的地方","我们 像没发生事一样","自顾地 走在路上","忘掉了的人只是泡沫","用双手轻轻一触就破","泛黄 有他泛黄的理由","思念将 越来越薄"]},{_id:6,title:"山水之间",artists:"许嵩",contentURI:"mp3/shanshuizhijian.mp3",thumbnail:"mp3/thumbnails/xusong.jpg",duration:"4:36",album:"不如吃茶去",lyrics:["昨夜同门云集 推杯又换盏","今朝茶凉酒寒 豪言成笑谈","半生累 尽徒然 碑文完美有谁看","隐居山水之间 誓与浮名散","湖畔青石板上 一把油纸伞","旅人停步折花 淋湿了绸缎","满树玉瓣多傲然 江南烟雨却痴缠","花飞雨追一如尘缘理还乱"]},{_id:7,title:"小苹果",artists:"筷子兄弟",contentURI:"mp3/xiaopingguo.mp3",thumbnail:"mp3/thumbnails/kuaizixiongdi.jpg",duration:"3:37",album:"老男孩之猛龙过江 电影原声",lyrics:["我种下一颗种子","终于长出了果实","今天是个伟大日子","摘下星星送给你","拽下月亮送给你","让太阳每天为你升起"]}]);
